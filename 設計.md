# ダークモード機能 設計書

## 📊 現状分析

### 既存のコンポーネント構造とスタイリング方法
- **フレームワーク**: Next.js 15 (App Router) + TypeScript + Tailwind CSS 4
- **スタイリング**: Tailwindの`dark:`プレフィックスを既に活用
- **カラースキーム**: CSS変数でカスタムカラーパレット定義済み
- **アイコン**: Lucide Reactを使用
- **状態管理**: React Hooksベースのローカル状態管理

### 現在の状態管理パターン
- `useState`と`useEffect`によるシンプルな状態管理
- `localStorage`での永続化パターンが確立済み
- 機能ごとのモーダル状態管理（例: 削除確認モーダル）

### UI/UXの整合性要件
- 既存のTailwindクラスで`dark:`プレフィックス使用済み
- ブランドカラー（#ff0033）の一貫性維持
- ボタンのホバー効果やトランジションアニメーション統一

## 🎯 設計課題と解決アプローチ

### 1. ユーザーが直感的に操作できるインターフェースデザイン

**課題**:
- テーマ切り替えボタンの視認性と操作性
- 現在のテーマ状態の明確な表示

**解決策**:
```tsx
// 📍 配置: TodoApp画面右上端（カンバン表示ボタンの隣）
// 🎨 デザイン: 丸いボタンに絵文字アイコン
// 🌙 ライトモード時: 月アイコン (🌙)
// ☀️ ダークモード時: 太陽アイコン (☀️)
// ✨ ホバー効果: 薄く光るエフェクト
```

### 2. システム全体で一貫性を保つアーキテクチャ

**課題**:
- HTML要素のクラス動的変更
- 既存コンポーネントとの整合性
- SSR対応とハイドレーション問題

**解決策**:
```tsx
// 🏗️ Context API + カスタムフック
// 🔄 html要素のclass属性制御
// 💾 localStorage永続化
// 🎨 既存のdark:プレフィックス活用
```

### 3. 保守性と拡張性を両立する実装方式

**課題**:
- テーマ設定の中央管理
- 将来のテーマ拡張に対応
- パフォーマンス最適化

**解決策**:
```tsx
// 📦 カスタムフック: useDarkMode
// 🎨 ThemeProvider でのContext提供
// 🔧 型安全なテーマ定義
// ⚡ メモ化によるパフォーマンス最適化
```

## 🏗️ アーキテクチャ設計

### コンポーネント構成
```
src/
├── hooks/
│   └── useDarkMode.ts          # 📝 ダークモード状態管理フック
├── components/
│   ├── shared/
│   │   ├── ThemeProvider.tsx   # 📝 テーマコンテキストプロバイダー
│   │   └── ThemeToggle.tsx     # 📝 テーマ切り替えボタン
│   └── list/
│       └── TodoApp.tsx         # 📝 テーマボタン統合
└── types/
    └── theme.ts                # 📝 テーマ関連型定義
```

### 型定義
```typescript
// 📝 src/types/theme.ts
export type Theme = 'light' | 'dark';

export interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
  isDark: boolean;
}
```

### カスタムフック設計
```typescript
// 📝 src/hooks/useDarkMode.ts
export interface UseDarkModeReturn {
  isDark: boolean;
  theme: Theme;
  toggleTheme: () => void;
  setTheme: (theme: Theme) => void;
}

// 🔄 機能:
// - システム設定の自動検出
// - localStorage永続化
// - HTML要素のclass属性制御
// - SSR対応のハイドレーション処理
```

### コンテキストプロバイダー
```typescript
// 📝 src/components/shared/ThemeProvider.tsx
// 🎯 責務:
// - アプリケーション全体へのテーマ状態提供
// - 初期化処理とシステム設定検出
// - ハイドレーション問題の解決
```

### テーマ切り替えボタン
```typescript
// 📝 src/components/shared/ThemeToggle.tsx
// 🎨 UI要件:
// - 丸いボタンデザイン (w-10 h-10 rounded-full)
// - 絵文字アイコン表示 (🌙/☀️)
// - ホバー効果 (hover:ring-2 hover:ring-opacity-50)
// - スムーズなトランジション
// - アクセシビリティ対応 (aria-label, title)
```

## 🎨 デザインシステム統合

### カラーパレット拡張
```css
/* 📝 src/app/globals.css 拡張 */
:root {
  /* 既存カラー */
  --background: #ffffff;
  --foreground: #171717;
  --primary: #ff0033;

  /* 📝 ダークモード対応拡張 */
  --background-secondary: #f8f9fa;
  --border-color: #e5e7eb;
  --text-muted: #6b7280;
}

@media (prefers-color-scheme: dark) {
  :root {
    /* 既存ダークカラー */
    --background: #0a0a0a;
    --foreground: #ededed;

    /* 📝 ダークモード拡張 */
    --background-secondary: #1f2937;
    --border-color: #374151;
    --text-muted: #9ca3af;
  }
}

/* 📝 ダークモード時のhtml要素スタイル */
.dark {
  --background: #0a0a0a;
  --foreground: #ededed;
  --background-secondary: #1f2937;
  --border-color: #374151;
  --text-muted: #9ca3af;
}
```

### Tailwindクラス戦略
```scss
// 📝 統一されたダークモード対応パターン
// ✅ 背景: bg-white dark:bg-gray-900
// ✅ カード: bg-gray-50 dark:bg-gray-700
// ✅ ボーダー: border-gray-200 dark:border-gray-600
// ✅ テキスト: text-gray-900 dark:text-gray-100
// ✅ ミューテッドテキスト: text-gray-500 dark:text-gray-400
```

## 🧪 テスト戦略

### カスタムフックテスト
```typescript
// 📝 src/hooks/__tests__/useDarkMode.test.ts
describe('useDarkMode', () => {
  // 🔄 初期状態テスト
  // 💾 localStorage永続化テスト
  // 🎨 テーマ切り替えテスト
  // 🖥️ システム設定検出テスト
});
```

### コンポーネントテスト
```typescript
// 📝 src/components/shared/__tests__/ThemeToggle.test.tsx
describe('ThemeToggle', () => {
  // 🖱️ クリックイベントテスト
  // 🎨 アイコン表示テスト
  // ♿ アクセシビリティテスト
  // 🎭 状態変更テスト
});
```

### 統合テスト
```typescript
// 📝 src/components/list/__tests__/TodoApp.darkmode.test.tsx
describe('TodoApp Dark Mode Integration', () => {
  // 🔄 テーマ切り替え統合テスト
  // 🎨 スタイル適用テスト
  // 💾 永続化テスト
});
```

## 📋 実装チェックリスト

### Phase 1: 基盤実装
- [ ] 型定義作成 (`src/types/theme.ts`)
- [ ] カスタムフック実装 (`src/hooks/useDarkMode.ts`)
- [ ] テーマプロバイダー実装 (`src/components/shared/ThemeProvider.tsx`)

### Phase 2: UI実装
- [ ] テーマ切り替えボタン実装 (`src/components/shared/ThemeToggle.tsx`)
- [ ] TodoAppへのボタン統合
- [ ] レイアウト調整とスタイル最適化

### Phase 3: テスト・品質保証
- [ ] カスタムフックテスト実装
- [ ] コンポーネントテスト実装
- [ ] 統合テスト実装
- [ ] アクセシビリティ検証

### Phase 4: 最適化・拡張
- [ ] パフォーマンス最適化
- [ ] SSR/SSG対応検証
- [ ] ドキュメント更新

## 🚀 パフォーマンス考慮事項

### 最適化ポイント
- **メモ化**: `useMemo`、`useCallback`での不要な再レンダリング防止
- **遅延読み込み**: テーマプロバイダーの動的インポート検討
- **バンドルサイズ**: アイコンライブラリの最適化
- **CLS対策**: ハイドレーション時のレイアウトシフト防止

### 実装優先度
1. **高**: 基本的なテーマ切り替え機能
2. **中**: アニメーション・トランジション
3. **低**: 高度な最適化・拡張機能

## 🔄 将来の拡張性

### 拡張可能な要素
- **テーマバリエーション**: システム/ライト/ダーク/ハイコントラスト
- **カスタムテーマ**: ユーザー定義カラーパレット
- **コンポーネントテーマ**: 個別コンポーネントレベルのテーマ設定
- **アニメーション**: テーマ切り替え時のスムーズアニメーション

この設計に基づいて、段階的に実装を進めることで、保守性と拡張性を両立したダークモード機能を実現できます。
